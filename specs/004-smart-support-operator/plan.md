# Implementation Plan: Operator Web Interface

**Branch**: `004-smart-support-operator` | **Date**: 2025-10-15 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/004-smart-support-operator/spec.md`

**Note**: This document is generated by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

Build a professional React + FastAPI web interface that enables support operators to analyze customer inquiries and retrieve relevant template responses in under 10 seconds. The system integrates existing Classification Module (90% accuracy, <2s) and Retrieval Module (93% top-3 accuracy, <1s) through a REST API backend, providing real-time classification, ranked template recommendations, visual confidence indicators, response editing, and copy-to-clipboard functionality. The interface must meet hackathon UI/UX criteria (20 points) with professional appearance and fast response times.

## Technical Context

**Language/Version**: Python 3.11+ (backend), Node.js 18+ (frontend)
**Primary Dependencies**:
- Backend: FastAPI 0.104+, Uvicorn, python-multipart, pydantic 2.x
- Frontend: React 18+, TypeScript, Tailwind CSS / Material-UI, Axios, React Query

**Storage**: SQLite (existing embeddings.db with 201 FAQ templates)
**Testing**:
- Backend: pytest, testcontainers-python (API contract tests)
- Frontend: Jest, React Testing Library
- E2E: Chrome DevTools MCP (end-to-end user scenarios)

**Target Platform**: Web browsers (Chrome, Firefox, Safari, Edge - desktop only)
**Project Type**: Web application (frontend + backend)

**Performance Goals**:
- Classification API: <2 seconds response time (95th percentile)
- Retrieval API: <1 second response time (95th percentile)
- Full operator workflow: <10 seconds (input → classify → retrieve → copy)
- UI response: All actions complete in <500ms (excluding API calls)

**Constraints**:
- Must integrate existing Classification and Retrieval modules without modification
- Hackathon demonstration focus (MVP over production-ready features)
- Desktop-only (no mobile responsive design required for MVP)
- Russian language only (no i18n required)

**Scale/Scope**:
- Single operator at a time (no concurrent user support needed for MVP)
- 201 FAQ templates across 6 categories, 35 subcategories
- Expected demo dataset: 10-15 sample inquiries

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Modular Architecture ✅
**Status**: PASS
**Compliance**: The operator interface is designed as a standalone module (Module 3) with clean API boundaries. Backend exposes REST endpoints that wrap existing Classifier and TemplateRetriever classes without modifying them. Frontend communicates solely through HTTP APIs.

### Principle II: User-Centric Design ✅
**Status**: PASS
**Compliance**: Specification focuses heavily on operator experience (20 points UI/UX in evaluation). Requirements prioritize speed (FR-015: <2s classification, FR-016: <1s retrieval), clarity (FR-010: visual confidence indicators), and efficiency (FR-006: one-click copy, FR-007: inline editing).

### Principle III: Data-Driven Validation ✅
**Status**: PASS
**Compliance**: Implementation plan includes:
- **Integration Tests**: testcontainers with real SQLite database to verify API contracts (FR-001 through FR-022)
- **E2E Tests**: Chrome DevTools MCP for complete user story validation (all 5 user stories with acceptance scenarios)
- **Performance Validation**: Automated measurement of classification/retrieval response times against requirements

### Principle IV: API-First Integration ✅
**Status**: PASS
**Compliance**: Backend wraps existing modules through FastAPI REST endpoints. Uses Pydantic models from `src/classification/models.py` and `src/retrieval/models.py` for type safety. No direct Scibox API calls from frontend.

### Principle V: Deployment Simplicity ✅
**Status**: PASS
**Compliance**: Will extend existing `docker-compose.yml` with new `operator-ui` service. Frontend build process integrated into Dockerfile. Single command launch: `docker-compose up operator-ui`.

### Principle VI: Knowledge Base Integration ✅
**Status**: PASS
**Compliance**: Uses existing pre-populated `data/embeddings.db` (201 templates). No new FAQ parsing required. Retrieval module handles all knowledge base operations.

**Overall Constitution Assessment**: ✅ **ALL GATES PASSED** - No violations. Ready to proceed to Phase 0.

## Project Structure

### Documentation (this feature)

```
specs/004-smart-support-operator/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (technology decisions)
├── data-model.md        # Phase 1 output (entity definitions)
├── quickstart.md        # Phase 1 output (development setup)
├── contracts/           # Phase 1 output (OpenAPI specs)
│   ├── classification-api.yaml
│   └── retrieval-api.yaml
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```
# Web application structure (frontend + backend)
backend/
├── src/
│   ├── api/                     # FastAPI application
│   │   ├── __init__.py          # App factory
│   │   ├── main.py              # FastAPI app instance, CORS, routes
│   │   ├── routes/
│   │   │   ├── classification.py  # POST /api/classify endpoint
│   │   │   └── retrieval.py      # POST /api/retrieve endpoint
│   │   ├── models.py            # Request/Response Pydantic models
│   │   └── middleware.py        # CORS, logging, error handling
│   └── __init__.py
├── tests/
│   ├── integration/             # testcontainers API tests
│   │   ├── test_classification_api.py
│   │   ├── test_retrieval_api.py
│   │   └── test_full_workflow.py
│   └── unit/
│       └── test_api_models.py
├── pyproject.toml               # Poetry/pip dependencies
└── requirements.txt

frontend/
├── src/
│   ├── components/              # React components
│   │   ├── InquiryInput.tsx     # Text input + submit button
│   │   ├── ClassificationDisplay.tsx  # Category/subcategory/confidence
│   │   ├── TemplateList.tsx     # Ranked template results
│   │   ├── TemplateCard.tsx     # Individual template with copy/edit
│   │   ├── LoadingSpinner.tsx   # Processing state indicator
│   │   ├── ErrorMessage.tsx     # User-friendly error display
│   │   └── ConfidenceBadge.tsx  # Visual high/medium/low indicator
│   ├── services/                # API client layer
│   │   ├── api.ts               # Axios instance with base URL
│   │   ├── classification.ts    # classify(inquiry) → ClassificationResult
│   │   └── retrieval.ts         # retrieve(request) → RetrievalResponse
│   ├── types/                   # TypeScript interfaces
│   │   ├── classification.ts    # Mirror of backend Pydantic models
│   │   └── retrieval.ts
│   ├── hooks/                   # React custom hooks
│   │   └── useClipboard.ts      # Copy-to-clipboard with feedback
│   ├── App.tsx                  # Main application component
│   ├── index.tsx                # React entry point
│   └── index.css                # Tailwind imports
├── public/
│   └── index.html
├── package.json                 # npm dependencies
├── tsconfig.json                # TypeScript configuration
├── tailwind.config.js           # Tailwind CSS configuration
└── vite.config.ts               # Vite build configuration

tests/
└── e2e/                         # End-to-end tests (Chrome DevTools MCP)
    ├── test_user_story_1.py     # P1: Inquiry Analysis and Template Retrieval
    ├── test_user_story_2.py     # P2: Response Customization
    └── test_edge_cases.py       # Edge case validation
```

**Structure Decision**: Selected **Option 2: Web application** structure because the specification explicitly describes a web-based operator interface with both frontend (React) and backend (FastAPI) components. This maps directly to the `frontend/` + `backend/` directories as outlined above. The backend integrates existing `src/classification/` and `src/retrieval/` modules through API routes without modifying them (Principle I: Modular Architecture).

## Complexity Tracking

*No Constitution Check violations - this section is empty.*

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|--------------------------------------|
| N/A | N/A | N/A |
